{
  "url": null,
  "timestamp": "2015-07-28 13:26:21 +0100",
  "card": {
    "name": "export",
    "type": "Pointer",
    "content": "[[wikirate coffee]]\n[[script: wikirate scripts]]",
    "value": [
      {
        "name": "wikirate coffee",
        "type": "CoffeeScript",
        "content": "\r\n###\r\nThis adds the special source editor (which is overwritten in right/source.rb)\r\nto this long-named map which gets triggered whenever we need javascript\r\nto translate fancy editor content into something friendly to the REST API.\r\n\r\nIt basically loops through each item in the list and gets the card name from the\r\nstandard \"data-card-name\" attribute.\r\n###\r\n\r\nwagn.editorContentFunctionMap['.source-editor > .pointer-list'] = ->\r\n  pointerContent @find('.TYPE-source').map( -> $(this).attr 'data-card-name' )\r\n\r\n###\r\nFIXME\r\nThe following code is cut and pasted from wagn_mod.js.coffee.  We need to scope\r\nit so that we can just refer to it and get rid of it here.\r\n###\r\n\r\npointerContent = (vals) ->\r\n  list = $.makeArray(vals)\r\n  list = $.map(list, (v, i) ->\r\n    \"[[\" + v + \"]]\"  if v and list.indexOf(v) is i\r\n  )\r\n  $.makeArray(list).join \"\\n\"\r\n\r\n$(window).ready ->\r\n\r\n  ###\r\n  To trigger click event if user forgets to click on 'add' button\r\n  ###\r\n  $('body').on('blur', '.RIGHT-source .sourcebox input',->\r\n    $('.TYPE-claim .sourcebox button')[0].click())\r\n\r\n  ###\r\n  The following is what translates the sourcebox into the form that we need\r\n  it for the REST API and handles the request/response.\r\n  ###\r\n\r\n  $('body').on 'click', '.RIGHT-source .sourcebox button', ->\r\n    button = $(this)\r\n    field = $(this).closest('.sourcebox').find('input')\r\n    sourceBox =  $(this).closest('.sourcebox')\r\n\r\n    #handle Error\r\n    errorDiv = '<div class=\"sourceErrorMsg\"> Invalid URL. (Valid URL looks like \"http://www.example.com\")</div>'\r\n\r\n    errorMsg = sourceBox.find('.sourceErrorMsg')\r\n    if errorMsg.length > 0\r\n      errorMsg.remove()\r\n\r\n    #unless field.val().match /^http/\r\n    if field.val().length == 0\r\n      sourceBox.find('.sourceErrorMsg').remove()\r\n      sourceBox.append(errorDiv)\r\n      $(\"#input_box_flag\").val(\"false\")\r\n      return false\r\n\r\n    listDiv = field.closest( '.content-editor' ).find '.source-editor > .pointer-list'\r\n\r\n    button.html 'Adding...'\r\n    button.attr 'disabled', true\r\n\r\n    $.ajax wagn.rootPath + '/card/create', {\r\n      data : {\r\n        success: { view : 'content' }\r\n        slot: { structure: 'source item' } #fixme -- need codename\r\n        sourcebox: 'true'\r\n        card: {\r\n          type_code: 'source'\r\n          subcards    : { '+Link' : { 'content' : field.val() } }\r\n        }\r\n      }\r\n      success: (data) ->\r\n        itemSlot = $('<div class=\"card-slot\"></div>')\r\n        listDiv.append itemSlot\r\n        itemSlot.slotSuccess data\r\n        field.val ''\r\n      error: (xhr) -> button.slot().slotError xhr.status, xhr.responseText\r\n      complete: ->\r\n        $(\"#input_box_flag\").val(\"false\")\r\n        button.html 'Add'\r\n        button.attr 'disabled', false\r\n    }\r\n\r\n    false #disable other events\r\n\r\n\r\n# we need to replace the following to retain decent 'add source' behavior'\r\n\r\n#  $('.TYPE-page .RIGHT-link').on 'change', 'input', ->\r\n#   field = $(this)\r\n#    frameslot = getFrameslot field\r\n#    frameslot.html $('<iframe src=\"' + field.val()  + '\"></iframe>')\r\n\r\n# the following may no longer be necessary.  it was a pre-\"chosen\" attempt at a topics editor\"\r\n\r\n  $('body').on 'click', '.wikirate-topic-list', (event) ->\r\n    listlink = $(this)\r\n    dialogDiv = listlink.data 'dialog'\r\n    dialogOptions = { minWidth: 400, maxHeight:400, position: { my: \"center\", at: \"center\", of: window } }\r\n    if dialogDiv\r\n      dialogDiv.dialog dialogOptions\r\n    else\r\n      $.ajax( url: listlink.attr('href') ).done (data)->\r\n        dialogDiv = listlink.slot().find '.wikirate-topic-dialog'\r\n        wagn.dd = dialogDiv\r\n        dialogDiv.html data\r\n        listlink.data 'dialog', dialogDiv\r\n        dialogDiv.dialog dialogOptions\r\n        dialogDiv.find('a').attr 'target','topics'\r\n    event.preventDefault()\r\n\r\n  $('#menu-bar').on 'mouseenter', '.main-links > div', ->\r\n    ul = $(this).find('ul').first()\r\n    ul.menu()\r\n    ul.show()\r\n    ul.position my: 'left top', at: 'left bottom', of: this\r\n\r\n  $('#menu-bar').on 'mouseleave', '.main-links > div', ->\r\n    ul = $(this).find('ul').first()\r\n    ul.hide()\r\n\r\n  $('body').on 'change', '.SELF-company_comparison select', ->\r\n    $(this).closest('form').submit()\r\n\r\n #Moving it to newClaimJs\r\n # To add the source on blur event.\r\n #$(\"body\").on \"blur\", \"#sourcebox\", ->\r\n #   $(\".sourcebox button\").trigger \"click\"\r\n\r\n#warn = (stuff) -> console.log stuff if console?\r\n",
        "codename": "wikirate_coffee"
      },
      {
        "name": "script: wikirate scripts",
        "type": "Pointer",
        "content": "[[script: new claim page]]\n[[script: new source page]]\n[[homepage carousel init]]\n[[homepage ie8 handling script]]\n[[script: source preview]]\n[[claim chosen]]\n[[modal window script]]\n[[activate readmore script]]\n[[suggested source script]]\n[[empty tab content script]]\n[[script: filter search]]\n[[wikirate coffee]]\n[[script: article page]]\n[[script: rating]]\n[[script: metrics]]\n[[import page script]]\n[[script: showcase]]"
      }
    ]
  }
}